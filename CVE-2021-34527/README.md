### 漏洞简述:

> 2021年06月29日，360CERT监测发现安全研究人员在GitHub上公开了Windows Print Spooler 蠕虫级远程代码执行0day漏洞的EXP，漏洞等级：严重，漏洞评分：10.0。
>
> Windows Print Spooler是Windows的打印机后台处理程序，广泛的应用于各种内网中，攻击者可以通过该漏洞绕过PfcAddPrinterDriver的安全验证，并在打印服务器中安装恶意的驱动程序。若攻击者所控制的用户在域中，则攻击者可以连接到DC中的Spooler服务，并利用该漏洞在DC中安装恶意的驱动程序，完整的控制整个域环境。
>
> 利用该0day漏洞，攻击者可以使用一个低权限用户（包括匿名共享guest账户），对本地网络中的电脑发起攻击，控制存在漏洞的电脑。尤其在企业内部，在域环境中，普通域用户，可以通过该服务，攻击域控服务器，从而控制整个网络。该漏洞广泛的存在于各Windows版本中，利用复杂度低，所以该漏洞的利用价值极高。
>
> 目前最新EXP已扩散，经过360CERT验证，该EXP可以绕过微软六月针对CVE-2021-1675漏洞的最新修补程序。同时，mimikatz已经将该POC武器化，并对外发布。
>
> 目前针对该EXP，微软官方暂无相关补丁。对此，360CERT建议广大用户在条件允许的情况下，暂时关闭域中的 Print Spooler服务，等待官方的最新修复程序。与此同时，请做好资产自查以及预防工作，以免遭受黑客攻击。

```
微软表示：PrintNightmare这个名字起得很好，因为该漏洞允许攻击者以系统权限运行任意代码，成功利用该漏洞的不法分子
（通过Windows打印机后台处理程序服务中的一个缺陷）可以安装程序、处理数据或创建具有完全用户权限的新账户。

早前，某网络安全公司的信息安全研究小组发布了该漏洞的概念验证代码，错误地认为它已经作为CVE-2021-1675的一部分进行了修补，
结果意外披露了零日漏洞。尽管该公司匆忙从Github撤下概念验证代码，但全球性的恐慌还是接踵而至。
```

#### 漏洞详情:

Windows Print Spooler 蠕虫级远程代码执行0day漏洞
CVE: CVE-2021-34527

组件: Windows Server 2019,Windows Server 2016,Windows Server 2012,Windows Server 2008,Windows 10,Windows 8.1,Windows 7

漏洞类型: **代码执行**

影响: **获得域管理权限**

简述: 利用该0day漏洞，攻击者可以使用一个低权限用户（包括匿名共享guest账户），对本地网络中的电脑发起攻击，控制存在漏洞的电脑。尤其在企业内部，在域环境中，普通域用户，可以通过该服务，攻击域控服务器，从而控制整个网络。

微软官方于 2021年07月01日紧急发布通告，并分配CVE编号

<font color=red>360CERT已复现该EXP</font>

<img src="https://cdn.jsdelivr.net/gh/mask75/imgs@master/20210705165052.png" alt="image-20210705165051164" style="zoom: 50%;" />

<font color=red>mimikatz 已经将该EXP武器化</font>

<img src="https://cdn.jsdelivr.net/gh/mask75/imgs@master/20210705165213.png" alt="image-20210705165212498" style="zoom:50%;" />

#### 影响版本:

* Windows Server 2019 (Server Core installation)

* Windows Server 2019

* Windows Server 2016 (Server Core installation)

* Windows Server 2016

* Windows Server 2012 R2 (Server Core installation)

* Windows Server 2012 R2

* Windows Server 2012 (Server Core installation)

* Windows Server 2012

* Windows Server 2008 R2 for x64-based Systems Service Pack 1 (Server Core installation)

* Windows Server 2008 R2 for x64-based Systems Service Pack 1

* Windows Server 2008 for x64-based Systems Service Pack 2 (Server Core installation)

* Windows Server 2008 for x64-based Systems Service Pack 2

* Windows Server 2008 for 32-bit Systems Service Pack 2 (Server Core installation)

* Windows Server 2008 for 32-bit Systems Service Pack 2

* Windows Server, version 2004 (Server Core installation)

* Windows RT 8.1

* Windows 8.1 for x64-based systems

* Windows 8.1 for 32-bit systems

* Windows 7 for x64-based Systems Service Pack 1

* Windows 7 for 32-bit Systems Service Pack 1

* Windows 10 Version 1607 for x64-based Systems

* Windows 10 Version 1607 for 32-bit Systems

* Windows 10 for x64-based Systems

* Windows 10 for 32-bit Systems

* Windows Server, version 20H2 (Server Core Installation)

* Windows 10 Version 20H2 for ARM64-based Systems

* Windows 10 Version 20H2 for 32-bit Systems

* Windows 10 Version 20H2 for x64-based Systems

* Windows 10 Version 2004 for x64-based Systems

* Windows 10 Version 2004 for ARM64-based Systems

* Windows 10 Version 2004 for 32-bit Systems

* Windows 10 Version 21H1 for 32-bit Systems

* Windows 10 Version 21H1 for ARM64-based Systems

* Windows 10 Version 21H1 for x64-based Systems

* Windows 10 Version 1909 for ARM64-based Systems

* Windows 10 Version 1909 for x64-based Systems

* Windows 10 Version 1909 for 32-bit Systems

* Windows 10 Version 1809 for ARM64-based Systems

* Windows 10 Version 1809 for x64-based Systems

* Windows 10 Version 1809 for 32-bit Systems

#### 修复建议:

##### 通用修复建议

微软官方于 2021年07月01日紧急通告

##### 微软官方通告

临时修复建议
360CERT建议广大用户在条件允许的情况下，暂时关闭域中的 Print Spooler服务，等待官方的最新修复程序。

禁用Print Spooler服务方式：

1. 在服务应用（services.msc）中找到Print Spooler服务。

   <img src="https://cdn.jsdelivr.net/gh/mask75/imgs@master/20210705165306.png" alt="image-20210705165304938" style="zoom:50%;" />


2. 停止运行服务，同时将“启动类型”修改为“禁用”。

<img src="https://cdn.jsdelivr.net/gh/mask75/imgs@master/20210705165333.png" alt="image-20210705165332148" style="zoom:50%;" />
